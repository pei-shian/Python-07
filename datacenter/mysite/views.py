from django.shortcuts import redirect
from django.shortcuts import render
from django.http import HttpResponse
import random
from mysite.models import Post
import json
import requests

def index(request):
	posts = Post.objects.all()
	myname = "月降雨量統計"
	data = [i for i in range(1,43)]
	random.shuffle(data)
	lotto_numbers = data[0:6]
	special_number = data[6]
	return render(request,'index.html',locals())

def show(request, id):
	try:
		target = Post.objects.get(id=id)
	except:

		
		return redirect("/")
	return render(request,"showpost.html", locals())
def weather(request, id):
    token = 'CWB-CF13E86E-3C39-4364-B74C-A79F63F31AE0'
    url = 'https://opendata.cwb.gov.tw/api/v1/rest/datastore/C-B0025-001?Authorization=' + token + '&format=JSON&sort=dataTime&statistics=true" -H  "accept: application/json'
    Data = requests.get(url)
    DATA = json.loads(Data.text)
    DATA_2 = DATA['records']['location']
    all_local_weather = []
    key = {0: '鞍部', 1: '新竹', 2: '金門', 3: '大武', 4: '成功', 5: '板橋', 6: '彰化', 7: '臺中', 8: '日月潭', 9: '雲林', 10: '屏東',
           11: '花蓮', 12: '新屋', 13: '宜蘭', 14: '阿里山', 15: '桃園', 16: '基隆', 17: '臺東', 18: '苗栗', 19: '高雄', 20: '恆春',
           21: '臺北', 22: '竹子湖', 23: '梧棲', 24: '嘉義', 25: '蘭嶼', 26: '東吉島', 27: '澎湖', 28: '臺南', 29: '淡水', 30: '蘇澳',
           31: '玉山', 32: '彭佳嶼', 33: '馬祖', 34: '田中'}
    for i in key:
        if id == i:
            local = key[i]
    for item in DATA_2:
        # print(item['stationObsTimes']['stationObsTime'][-1])
        # print(item['stationObsTimes']['stationObsTime'][-1]['dataDate'])
        # print(item['stationObsTimes']['stationObsTime'][-1]['weatherElements']['precipitation'])
        # print(item['station']['stationName'])
        local_weather = {
            "rainfall": item['stationObsTimes']['stationObsTime'][-1]['weatherElements']['precipitation'],
            'local': item['station']['stationName'],
            "time": item['stationObsTimes']['stationObsTime'][-1]['dataDate']}
        all_local_weather.append(local_weather)
    for item in all_local_weather:
        if local == item['local']:
            local_weather = item
    a_all ,a_image_all =  gel_rainalll(local)
    print(a_all,a_image_all)
    return render(request, 'weather.html', locals())


def gel_rainalll(city):
    all_rain = {'臺北': [[256.0, 78.9, 285.7, 184.4, 186.7, 429.8, 174.6, 141.4, 428.5, 137.6, 111.6, 16.5],
                       [21.8, 123.7, 182.7, 121.5, 135.5, 649.7, 206.6, 166.2, 175.6, 368.6, 120.9, 66.9],
                       [255.8, 163.6, 37.3, 59.6, 42.0, 119.8, 190.3, 186.8, 321.9, 125.1, 64.4, 54.4],
                       [45.0, 64.1, 184.2, 115.1, 335.8, 419.5, 439.3, 212.4, 377.1, 27.1, 13.8, 136.2],
                       [38.6, 29.6, 245.5, 87.9, 405.8, 117.9, 133.5, 322.5, 129.5, 25.5, 21.5, 145.0]],
                '基隆': [[441.2, 422.2, 317.1, 192.9, 176.2, 255.0, 125.3, 112.3, 531.7, 814.9, 313.0, 139.6],
                       [254.7, 264.5, 288.8, 141.9, 229.1, 824.9, 67.9, 20.2, 188.8, 409.8, 708.2, 458.8],
                       [541.7, 360.5, 69.4, 108.7, 52.0, 244.5, 135.8, 92.0, 558.4, 403.5, 261.2, 578.0],
                       [382.1, 292.4, 209.1, 140.0, 404.2, 431.1, 102.3, 173.3, 659.1, 152.3, 219.0, 352.6],
                       [189.0, 161.7, 202.7, 223.8, 475.7, 91.7, 134.0, 212.0, 485.4, 505.0, 277.5, 936.5]],
                '臺中': [[204.9, 24.2, 194.6, 183.4, 100.3, 230.9, 166.7, 184.6, 126.2, 23.9, 74.2, 8.4],
                       [4.0, 20.8, 38.0, 98.8, 111.5, 894.0, 313.7, 69.0, 21.4, 53.5, 19.5, 8.0],
                       [103.5, 25.5, 35.5, 30.5, 73.0, 234.0, 347.0, 408.5, 20.0, 7.5, 10.0, 2.0],
                       [13.0, 11.0, 179.5, 115.5, 524.0, 480.0, 177.5, 768.0, 133.5, 11.5, 0.0, 94.5],
                       [20.0, 4.5, 55.0, 59.5, 306.5, 183.5, 93.5, 278.5, 74.0, 'T', 3.5, 41.5]],
                '日月潭': [[326.5, 42.0, 275.0, 239.0, 160.0, 443.0, 205.5, 179.3, 258.0, 75.6, 68.0, 21.5],
                       [4.0, 14.0, 57.5, 255.5, 347.5, 1013.0, 424.5, 183.5, 118.0, 85.0, 48.0, 17.5],
                       [150.0, 72.0, 45.0, 108.0, 95.0, 427.0, 316.0, 556.5, 128.5, 18.0, 24.5, 1.0],
                       [9.0, 6.5, 171.5, 135.0, 674.0, 754.5, 216.5, 664.5, 92.0, 9.5, 0.0, 138.0],
                       [11.5, 70.5, 90.0, 72.0, 508.0, 330.0, 239.0, 249.0, 81.0, 'T', 5.0, 51.0]],
                '嘉義': [[139.4, 12.3, 129.7, 193.5, 33.5, 262.5, 208.7, 189.4, 637.2, 24.8, 44.7, 10.0], 
                       [1.3, 1.2, 18.4, 105.9, 77.8, 578.0, 663.2, 198.6, 117.2, 79.0, 10.5, 3.7], 
                       [76.5, 23.7, 31.5, 7.8, 46.5, 428.2, 377.9, 858.5, 118.5, 8.8, 8.0, 'T'], 
                       [5.0, 8.0, 107.9, 74.0, 239.7, 316.5, 335.5, 631.5, 132.2, 5.5, 0.0, 122.0], 
                       [14.0, 10.0, 58.0, 37.0, 287.3, 124.3, 128.0, 262.2, 31.0, 1.5, 6.0, 23.5]],
                '花蓮': [[159.5, 25.0, 126.5, 64.0, 174.0, 169.0, 337.0, 284.5, 861.5, 680.2, 185.0, 43.0],
                       [19.0, 51.5, 76.0, 106.2, 144.5, 211.0, 153.5, 138.0, 126.0, 753.0, 99.0, 70.5], 
                       [96.0, 61.0, 67.5, 31.0, 25.7, 122.5, 36.5, 317.0, 199.0, 133.5, 249.5, 49.0], 
                       [71.0, 52.5, 92.5, 73.5, 218.0, 164.5, 66.5, 289.0, 228.0, 157.0, 109.5, 133.0], 
                       [50.7, 18.6, 119.1, 57.0, 171.5, 53.5, 105.0, 101.5, 107.0, 259.0, 146.0, 84.0]],
                '淡水': [[297.8, 104.6, 317.0, 159.5, 155.4, 576.4, 280.5, 194.4, 503.2, 121.2, 116.5, 14.5], 
                       [25.0, 124.4, 205.0, 125.7, 152.9, 673.0, 212.6, 124.6, 51.2, 364.1, 124.5, 71.1], 
                       [291.2, 191.8, 34.5, 74.0, 35.0, 46.1, 209.7, 188.4, 158.6, 128.7, 89.8, 69.9], 
                       [48.8, 69.1, 197.8, 115.4, 388.7, 452.3, 362.7, 210.0, 291.4, 33.5, 18.9, 182.0], 
                       [47.6, 37.5, 307.0, 97.1, 427.6, 108.3, 256.0, 342.0, 164.0, 30.0, 25.0, 142.0]],
                '桃園': [[333.5, 125.5, 292.0, 215.0, 176.5, 350.5, 20.0, 81.0, 400.5, 63.5, 148.0, 13.0], 
                       [40.5, 107.5, 195.0, 108.5, 84.0, 637.5, 111.5, 3.5, 38.0, 149.5, 104.5, 51.0], 
                       [295.0, 129.0, 50.0, 88.5, 24.5, 67.0, 117.5, 328.0, 127.0, 108.5, 41.0, 52.0], 
                       [52.5, 80.5, 225.5, 135.5, 428.5, 364.0, 212.0, 292.0, 231.0, 14.0, 12.5, 166.5], 
                       [49.0, 56.0, 195.0, 72.5, 340.0, 91.0, 55.0, 333.0, 146.5, 25.0, 17.0, 98.5]],
                '新竹': [[311.1, 73.3, 304.4, 285.1, 206.0, 230.5, 44.6, 100.9, 319.4, 27.0, 118.7, 6.5], 
                       [23.4, 91.7, 154.6, 124.0, 99.5, 581.5, 89.7, 54.2, 64.8, 51.8, 35.0, 23.8], 
                       [266.7, 83.5, 53.5, 61.7, 59.0, 71.2, 67.2, 264.4, 134.5, 40.8, 31.0, 30.5], 
                       [25.5, 67.9, 279.7, 217.0, 515.0, 482.7, 48.5, 211.4, 92.0, 11.5, 6.9, 140.2], 
                       [36.0, 55.0, 105.0, 72.5, 353.2, 46.0, 0.7, 219.5, 80.5, 5.0, 7.5, 44.5]],
                '苗栗': [[255.0, 33.0, 343.0, 241.5, 163.0, 154.0, 77.5, 151.0, 179.0, 8.0, 83.5, 5.0], 
                       [9.5, 63.0, 102.5, 116.0, 94.5, 693.5, 293.5, 36.5, 81.5, 29.0, 12.5, 9.5], 
                       [168.5, 41.0, 65.0, 94.0, 66.5, 160.0, 71.5, 272.0, 56.5, 11.5, 18.5, 15.0], 
                       [27.0, 37.5, 289.0, 142.5, 297.0, 440.5, 77.5, 443.0, 52.5, 12.5, 0.0, 113.5], 
                       [32.5, 15.0, 104.0, 57.5, 353.5, 89.5, 31.5, 116.5, 19.0, 12.5, 5.5, 46.0]],
                '彰化': [[188.0, 22.0, 165.0, 142.0, 47.5, 218.5, 76.5, 186.0, 262.5, 40.5, 7.0, 12.0], 
                       [5.0, 8.0, 42.5, 123.5, 110.0, 995.0, 353.5, 71.5, 26.0, 64.0, 28.0, 10.0], 
                       [105.5, 32.0, 31.5, 32.0, 86.0, 195.5, 450.0, 530.5, 39.5, 2.0, 17.5, 0.5], 
                       [9.0, 8.0, 133.5, 82.5, 290.5, 466.0, 186.0, 395.5, 53.0, 8.0, 0.0, 101.5], 
                       [18.5, 0.5, 49.5, 38.0, 285.5, 37.0, 80.0, 210.5, 4.5, 0.5, 2.5, 25.5]],
                '雲林': [[166.0, 34.5, 155.0, 128.0, 32.0, 280.0, 257.5, 116.0, 441.5, 20.5, 69.5, 12.5], 
                       [3.0, 5.5, 37.0, 108.0, 66.5, 946.5, 481.5, 142.0, 84.0, 69.0, 8.0, 5.5], 
                       [90.0, 38.5, 37.0, 26.0, 34.5, 246.0, 326.0, 627.0, 83.0, 2.5, 20.5, 0.0], 
                       [6.0, 7.0, 137.0, 53.0, 195.0, 413.5, 167.0, 661.0, 203.0, 8.0, 0.0, 139.0], 
                       [17.5, 0.0, 41.5, 39.5, 458.5, 86.5, 76.0, 335.5, 33.0, 0.0, 5.0, 36.0]],
                '臺南': [[170.9, 38.0, 96.5, 146.0, 87.3, 376.5, 374.0, 91.5, 1220.3, 69.0, 48.9, 2.0], 
                       [0.0, 1.0, 12.8, 64.5, 79.5, 251.5, 506.9, 196.5, 39.5, 39.5, 1.5, 2.0], 
                       [40.0, 11.5, 19.0, 0.5, 83.9, 555.5, 406.0, 1301.0, 31.0, 0.5, 1.0, 0.0], 
                       ['T', 1.5, 74.5, 88.0, 168.0, 273.5, 573.0, 758.0, 180.0, 0.0, 0.0, 60.7], 
                       [27.5, 1.5, 29.5, 23.0, 470.5, 58.5, 141.0, 663.5, 56.3, 1.0, 52.0, 6.0]],
                '高雄': [[179.5, 24.5, 79.0, 182.5, 97.5, 383.0, 315.0, 427.0, 1098.0, 259.5, 57.0, 1.0], 
                       [0.0, 0.0, 3.5, 113.5, 129.0, 256.0, 285.0, 211.0, 32.5, 82.5, 11.0, 0.5], 
                       [23.5, 4.5, 57.0, 9.5, 58.7, 835.0, 410.0, 1600.5, 66.0, 1.5, 2.0, 0.0], 
                       [2.5, 12.5, 44.0, 63.2, 196.3, 357.5, 500.0, 726.2, 247.0, 52.5, 2.0, 22.3], 
                       [26.5, 0.5, 29.0, 34.5, 748.0, 163.0, 146.5, 915.0, 27.5, 9.5, 55.0, 7.5]],
                '屏東': [[128.5, 10.5, 79.5, 180.0, 56.5, 376.0, 716.5, 584.0, 1245.5, 114.0, 45.5, 1.0], 
                       [0.0, 0.0, 6.5, 97.0, 68.0, 381.0, 131.0, 118.5, 193.0, 152.5, 12.0, 0.5], 
                       [35.5, 7.5, 43.0, 31.5, 63.0, 790.0, 948.0, 1536.0, 203.5, 17.0, 0.0, 0.0], 
                       [1.5, 11.0, 28.0, 85.5, 301.0, 229.0, 788.0, 669.5, 234.5, 110.5, 3.5, 26.0], 
                       [22.0, 1.5, 33.5, 35.5, 608.0, 93.0, 187.0, 742.5, 110.0, 10.5, 21.5, 8.5]],
                '宜蘭': [[122.1, 119.1, 177.3, 102.4, 89.7, 209.1, 134.7, 154.2, 609.8, 492.8, 244.3, 222.5], 
                       [96.6, 74.7, 97.3, 151.8, 227.6, 312.1, 133.9, 45.4, 660.8, 661.8, 430.0, 435.9],
                       [388.8, 92.1, 40.2, 25.8, 33.1, 245.3, 91.6, 145.1, 165.0, 535.1, 436.7, 306.7],
                       [447.4, 56.3, 132.5, 180.3, 360.2, 180.8, 67.1, 218.0, 514.6, 228.7, 136.1, 162.6], 
                       [31.9, 40.0, 68.7, 124.2, 342.3, 116.0, 56.0, 194.5, 168.5, 621.0, 483.5, 562.5]],
                '花蓮': [[159.5, 25.0, 126.5, 64.0, 174.0, 169.0, 337.0, 284.5, 861.5, 680.2, 185.0, 43.0], 
                       [19.0, 51.5, 76.0, 106.2, 144.5, 211.0, 153.5, 138.0, 126.0, 753.0, 99.0, 70.5], 
                       [96.0, 61.0, 67.5, 31.0, 25.7, 122.5, 36.5, 317.0, 199.0, 133.5, 249.5, 49.0], 
                       [71.0, 52.5, 92.5, 73.5, 218.0, 164.5, 66.5, 289.0, 228.0, 157.0, 109.5, 133.0], 
                       [50.7, 18.6, 119.1, 57.0, 171.5, 53.5, 105.0, 101.5, 107.0, 259.0, 146.0, 84.0]],
                '臺東': [[151.5, 21.7, 62.0, 135.7, 43.1, 91.6, 298.2, 215.8, 608.0, 991.2, 202.9, 30.8], 
                       [6.7, 24.4, 42.2, 82.8, 184.5, 170.4, 188.7, 314.5, 162.0, 762.9, 17.2, 15.2], 
                       [53.9, 14.1, 38.4, 74.0, 22.8, 206.2, 111.1, 493.1, 254.3, 37.0, 30.7, 54.8], 
                       [35.5, 12.9, 36.0, 28.3, 165.7, 132.9, 136.9, 216.4, 202.1, 25.3, 8.4, 92.0], 
                       [34.6, 32.2, 41.2, 48.2, 291.8, 78.8, 86.0, 190.5, 103.0, 94.0, 125.0, 12.0]],
                '澎湖': [[122.6, 10.6, 134.0, 252.8, 95.3, 94.8, 215.5, 168.8, 559.6, 80.2, 57.3, 3.9], 
                       [0.9, 3.4, 16.8, 132.3, 81.2, 314.7, 240.5, 98.8, 20.1, 13.0, 26.7, 5.4], 
                       [58.3, 10.9, 45.2, 14.2, 39.5, 116.4, 23.2, 611.2, 1.5, 2.5, 31.7, 4.3], 
                       [12.0, 28.5, 111.5, 114.8, 77.9, 92.7, 178.5, 169.6, 0.6, 0.0, 'T', 139.4], 
                       [8.4, 7.1, 29.1, 45.1, 273.1, 51.6, 8.5, 225.5, 32.0, 'T', 24.5, 15.5]],
                        }
    year = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October',
            'November',
            'December']
    year_2 = ['a_5', 'a_6', 'a_7', 'a_8', 'a_9']
    a_all = []
    a_image_all = {}
    data = {}
    for item in all_rain:
        if item == city:
            a_image_all.update({'a_5':all_rain[item][0]})
            a_image_all.update({'a_6':all_rain[item][1]})
            a_image_all.update({'a_7':all_rain[item][2]})
            a_image_all.update({'a_8':all_rain[item][3]})
            a_image_all.update({'a_9':all_rain[item][4]})
            for i in all_rain[item]:
                a_all.append({
                    year[0]: i[0],
                    year[1]: i[1],
                    year[2]: i[2],
                    year[3]: i[3],
                    year[4]: i[4],
                    year[5]: i[5],
                    year[6]: i[6],
                    year[7]: i[7],
                    year[8]: i[8],
                    year[9]: i[9],
                    year[10]: i[10],
                    year[11]: i[11],
                })
    return a_all ,a_image_all

def us(request):
  return render(request,"about_us.html", locals())